<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://xxliud.github.io</id>
    <title>Zcbb - Workspace</title>
    <updated>2020-06-30T13:49:44.450Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://xxliud.github.io"/>
    <link rel="self" href="https://xxliud.github.io/atom.xml"/>
    <subtitle>å¿µå¿µä¸å¿˜ï¼Œå¿…æœ‰å›å“</subtitle>
    <logo>https://xxliud.github.io/images/avatar.png</logo>
    <icon>https://xxliud.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, Zcbb - Workspace</rights>
    <entry>
        <title type="html"><![CDATA[Vue - Vuex Storeä¸“é¢˜]]></title>
        <id>https://xxliud.github.io/post/vue-vuex/</id>
        <link href="https://xxliud.github.io/post/vue-vuex/">
        </link>
        <updated>2020-06-30T12:11:13.000Z</updated>
        <content type="html"><![CDATA[<h1 id="vuex-storeæ˜¯ä»€ä¹ˆ">Vuex Storeæ˜¯ä»€ä¹ˆï¼Ÿ</h1>
<p>vuex store æ˜¯vueçš„çŠ¶æ€ç®¡ç†æ¨¡å—ï¼Œvuex store æ˜¯å“åº”å¼çš„ï¼Œå½“vueç»„ä»¶ä»storeä¸­è¯»å–çŠ¶æ€ï¼ˆstateï¼‰æ—¶ï¼Œè‹¥storeä¸­çš„çŠ¶æ€å‘ç”Ÿæ›´æ–°æ—¶ï¼Œä¼šåŠæ—¶çš„å“åº”ç»™å…¶ä»–çš„ç»„ä»¶ã€‚<br>
store ä¸­çš„å››ä¸ªæ ¸å¿ƒé€‰é¡¹:     state mutations  getters  actions</p>
<h1 id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³</h1>
<ul>
<li>state<br>
stateæ˜¯ç”¨æ¥å­˜æ”¾ç»„ä»¶ä¹‹é—´å…±äº«çš„æ•°æ®ï¼Œä¸€èˆ¬ä¼šåœ¨ç»„ä»¶çš„è®¡ç®—å±æ€§ä¸­è·å–stateçš„æ•°æ®ã€‚<br>
è°ƒç”¨æ–¹æ³•ï¼š this.$store.state.[å±æ€§name]ï¼Œåªæœ‰è¯»å±æ€§ï¼Œæ²¡æœ‰å†™å±æ€§ã€‚</li>
</ul>
<pre><code class="language-javascript">//  '@/store/index.js'
const store = new Vuex.Store({
  state: {
    token: null,
    count: 0
  },
  mutations: mutations,
  modules: {
    user
  }
});

//  '@/pages/myTest/myTest.vue
export default {
  name: 'myTest',
  components: {},
  data() {
    return {
      token: this.$store.state.token
    };
  }
  }
</code></pre>
<ul>
<li>mutations<br>
åœ¨ Vuex store ä¸­ï¼Œå®é™…æ”¹å˜ çŠ¶æ€(state) çš„å”¯ä¸€æ–¹å¼æ˜¯é€šè¿‡æäº¤(commit) ä¸€ä¸ª mutationã€‚<br>
åœ¨ç»„ä»¶é‡Œæäº¤ï¼š this.$store.commit('change', payload)<br>
mutationsä¸‹çš„å‡½æ•°æ¥æ”¶stateä½œä¸ºå‚æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå«åšpayloadï¼ˆè½½è·ï¼‰çš„ä¸œè¥¿ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™ä¸ªä¸œä¸œæ˜¯ç”¨æ¥è®°å½•å¼€å‘è€…ä½¿ç”¨è¯¥å‡½æ•°çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´æäº¤äº†ä»€ä¹ˆï¼Œæäº¤çš„ä¸œè¥¿æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼ŒåŒ…å«å¤šä¸ªå­—æ®µï¼Œæ‰€ä»¥è½½è·ä¸€èˆ¬æ˜¯å¯¹è±¡ã€‚</li>
</ul>
<pre><code class="language-javascript">//  '@/store/index.js'
const store = new Vuex.Store({
  state: {
    token: null,
    count: 0
  },
  mutations: mutations,
  modules: {
    user
  }
});

//  '@/store/mutations.js
let mutations = {
  // è®¡æ•°å™¨
  addCount(state, num) {
    if (num) {
      state.count += num;
    }
  }
}

//  '@/pages/myTest/myTest.vue'
export default {
  computed: {
    this.$store.commit('addCount', 2)
  }
}
</code></pre>
<ul>
<li>getters<br>
getterså¯ä»¥çœ‹æˆæ˜¯storeçš„è®¡ç®—å±æ€§ã€‚<br>
gettersä¸‹çš„å‡½æ•°æ¥æ”¶stateä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚getterså¯ä»¥è¿‡æ»¤ç»„ä»¶ä¸­çš„æ•°æ®ï¼Œè¿‡æ»¤çš„æ•°æ®ä¼šå­˜æ”¾åˆ°$store.getterså¯¹è±¡ä¸­ã€‚</li>
</ul>
<pre><code class="language-javascript">//  '@/store/index.js'
const store = new Vuex.Store({
  state: {
    token: null,
    count: 0
  },
  mutations: mutations,
  getters: getters,
  modules: {
    user
  }
});

//  '@/store/getters.js
let getters = {
  // è®¡æ•°å™¨
  getCount(state) {
      return state.count
  }
}

//  '@/pages/myTest/myTest.vue'
export default {
  data: {
      count: this.$store.state.getount();
  }
}
</code></pre>
<ul>
<li>actions<br>
actionsï¼šç±»ä¼¼äºmutation ï¼Œä½†æ˜¯mutationsåªèƒ½å¤„ç†åŒæ­¥å‡½æ•°ï¼Œè€Œactionsåˆ™æ˜¯å¯ä»¥å¤„ç†ä»»ä½•çš„å¼‚æ­¥æ“ä½œã€‚</li>
</ul>
<pre><code class="language-javascript">//  '@/store/index.js'
const store = new Vuex.Store({
  state: {
    token: null,
    count: 0
  },
  mutations: mutations,
  getters: getters,
  actions: actions,
  modules: {
    user
  }
});

//  '@/store/action.js
let actions = {
  // è®¡æ•°å™¨
  getInfo({
    commit
  }, params) {
    commit('updateMail', params.mail);
    commit('updatePhone', params.phone)
  }
}

//  '@/pages/myTest/myTest.vue'
export default {
  computed: {
    this.$store.dispath('getInfo', {'mail': '327xxx@qq.com', 'phone': '139xxxxxxx'})
  }
}
</code></pre>
<p>ğŸ’¡actionså’Œmutationsçš„åŒºåˆ«<br>
1.Actions æäº¤çš„æ˜¯ mutationsï¼Œè€Œä¸æ˜¯ç›´æ¥å˜æ›´çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œactionsä¼šé€šè¿‡mutationsï¼Œè®©mutationså¸®ä»–æäº¤æ•°æ®çš„å˜æ›´ã€‚<br>
2.Action å¯ä»¥åŒ…å«ä»»æ„å¼‚æ­¥æ“ä½œã€‚</p>
<h1 id="store-åˆ†å±‚">Store åˆ†å±‚</h1>
<p>åˆ†äº«ä¸€ä¸‹æˆ‘é¡¹ç›®ä¸­storeçš„å±‚çº§å…³ç³»<br>
<img src="https://xxliud.github.io/post-images/1593523832808.png" alt="" loading="lazy"></p>
<pre><code class="language-shell">-- store
--- modules  # æ¨¡å—åŒ–
---- user.js   # store.user
--- index.js   # storeå®ä¾‹
--- actions_type.js   # actons type list
--- mutations_type.js  # mutations type list
--- mutations.js   # store -&gt; mutations
</code></pre>
<p>é¡¹ç›®å†…å¹¶æœªä½¿ç”¨gettersï¼Œå¤§éƒ¨åˆ†è®¡ç®—å±æ€§éƒ½æ”¾åˆ°äº†vueçš„computedé‡Œäº†</p>
<ul>
<li>index.js å®šä¹‰storeå®ä¾‹</li>
</ul>
<pre><code class="language-javascript"> // '@/store/index.js'
import Vue from 'vue';
import Vuex from 'vuex';
import mutations from '@/store/mutations';
import user from './modules/user.js'

Vue.use(Vuex);

//=======vuex store start===========
const store = new Vuex.Store({
  state: {
    token: null,
    count: 0
  },
  mutations: mutations,
  modules: {
    user
  }
});
//=======vuex store end===========
export default store
</code></pre>
<ul>
<li>mutations.js å®šä¹‰æ¨¡å—å¤–stateçš„ä¸€äº›å˜æ›´æ–¹æ³•</li>
</ul>
<pre><code class="language-javascript">let mutations = {
  // è®¡æ•°å™¨
  addCount(state, num) {
    if (num) {
      state.count += num;
    }
  }
}
export default mutations
</code></pre>
<ul>
<li>mutations_type.js å®šä¹‰moduleé‡Œmutationsçš„ç±»åˆ«</li>
</ul>
<pre><code class="language-javascript">//user.js
export const SAVE_USER_USERNAME = &quot;SAVE_USER_USERNAME&quot;
export const SAVE_USER_DISPLAYNAME = &quot;SAVE_USER_DISPLAYNAME&quot;
export const SAVE_USER_MAIL = &quot;SAVE_USER_MAIL&quot;
export const SAVE_USER_PHONE = &quot;SAVE_USER_PHONE&quot;
export const SAVE_USER_ROLE = &quot;SAVE_USER_ROLE&quot;
export const SAVE_USER_TOKEN = &quot;SAVE_USER_TOKEN&quot;
</code></pre>
<ul>
<li>actions_type.js å®šä¹‰moduleé‡Œactionsçš„ç±»åˆ«</li>
</ul>
<pre><code class="language-javascript">//user.js
export const COMPUTED_INFO = &quot;COMPUTED_INFO&quot;
</code></pre>
<ul>
<li>modules/user.js å®šä¹‰ä¸€ä¸ªæ¨¡å—user</li>
</ul>
<pre><code class="language-javascript">import {
  GET_USER_MESSAGE,
  SAVE_USER_USERNAME,
  SAVE_USER_DISPLAYNAME,
  SAVE_USER_MAIL,
  SAVE_USER_PHONE,
  SAVE_USER_ROLE,
  SAVE_USER_TOKEN
} from '@/store/mutations_type.js'
import {
  COMPUTED_INFO
} from '@/store/actions_type.js'
import axios from 'axios'
axios.defaults.withCredentials = true;
import router from '@/router';

const state = {
  username: '',
  displayName: '',
  mail: '',
  phone: '',
  role: '',
  projectTree: '',
  token: ''
}

const getters = {

}

const mutations = {
  [SAVE_USER_TOKEN]: (state, value) =&gt; {
    state.token = value
  },
  [SAVE_USER_USERNAME]: (state, value) =&gt; {
    state.username = value
  },
  [SAVE_USER_DISPLAYNAME]: (state, value) =&gt; {
    state.displayName = value
  },
  [SAVE_USER_MAIL]: (state, value) =&gt; {
    state.mail = value
  },
  [SAVE_USER_PHONE]: (state, value) =&gt; {
    state.phone = value
  },
  [SAVE_USER_ROLE]: (state, value) =&gt; {
    state.role = value
  }
}

const actions = {
  [COMPUTED_INFO]: ({
    commit
  }, params) =&gt; {
    commit(SAVE_USER_MAIL, params.mail);
    commit(SAVE_USER_PHONE, params.phone)
  },
  getUserInfo({
    commit
  }, params) {
    commit(SAVE_USER_MAIL, params.mail);
    commit(SAVE_USER_PHONE, params.phone)
  }
}

export default {
  namespaced: true,
  state,
  mutations,
  actions
}
</code></pre>
<ul>
<li>vueä¸­å¦‚ä½•é…¸çˆ½çš„ä½¿ç”¨ï¼Ÿ</li>
</ul>
<ol>
<li>è·å–stateå±æ€§</li>
</ol>
<pre><code class="language-javascript">export default {
  name: 'myTest',
  components: {},
  data() {
    return {
      token: this.$store.state.token   // ç²—æš´æ–¹æ³•
    };
  },
  computed: {
    ...mapState({
      count: state =&gt; state.count   // ä¼˜é›…æ–¹æ³•
    })
  }
</code></pre>
<ol>
<li>æ‰§è¡Œmutations</li>
</ol>
<pre><code class="language-javascript">mounted() {
    this.changeUserName(&quot;zcbb...2017&quot;);  // ä¼˜é›…æ–¹æ³•
    this.$store.user.commit(&quot;SAVE_USER_USERNAME&quot;, &quot;zcbb...2015&quot;);  // ç²—æš´æ–¹æ³•
  },
  watch: {},
  created() {},
  methods: {
    ...mapMutations({
      changeUserName: &quot;user/SAVE_USER_USERNAME&quot;
    })
}
</code></pre>
<ol start="3">
<li>æ‰§è¡Œactions</li>
</ol>
<pre><code class="language-javascript">mounted() {
    this.actionUserInfo({         // ä¼˜é›…æ–¹æ³•   
      &quot;mail&quot;: &quot;visir.liu@qq.com&quot;,
      &quot;phone&quot;: &quot;17694806300&quot;
    });
    this.$store.user.dispath(&quot;COMPUTED_INFO&quot;, {     // ç²—æš´æ–¹æ³•
      &quot;mail&quot;: &quot;visir.liu@qq.com&quot;,
      &quot;phone&quot;: &quot;17694806300&quot;
    })
  },
watch: {},
created() {},
methods: {
...mapActions({
    actionUserInfo: &quot;user/COMPUTED_INFO&quot;
    })
}
</code></pre>
<p>è‡³æ­¤vuex storeä»‹ç»å®Œæ¯•..</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue - çŸ¥è¯†ç‚¹å¤§æ±‡æ€»]]></title>
        <id>https://xxliud.github.io/post/vue-knowledge/</id>
        <link href="https://xxliud.github.io/post/vue-knowledge/">
        </link>
        <updated>2020-06-24T14:29:12.000Z</updated>
        <content type="html"><![CDATA[<p>[ * ] <a href="https://xxliud.github.io/post/vue-vuex" title="vue-store">vue-store</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[K8s - é‡‘ä¸é›€å‘å¸ƒ]]></title>
        <id>https://xxliud.github.io/post/k8s-gray/</id>
        <link href="https://xxliud.github.io/post/k8s-gray/">
        </link>
        <updated>2020-06-23T16:16:43.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li>ç¡®è®¤istio-ingressgatewayæ˜¯å¦æœ‰å¯¹å¤–çš„IP</li>
</ul>
<pre><code class="language-shell">kubectl get  service istio-ingressgateway -n istio-system
</code></pre>
<ul>
<li>ç¼–è¾‘EXTERNAL-IPï¼Œå†™å…¥ClusterIPä¸ºå¤–ç½‘ip</li>
</ul>
<pre><code class="language-shell">kubectl edit  service istio-ingressgateway -n istio-system
</code></pre>
<ul>
<li>å»ºç«‹deployment</li>
</ul>
<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: nginx-app-1
spec:
  replicas: 1
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: &quot;true&quot;
      labels:
        app: nginx-app
        version: v1
    spec:
      containers:
        - name: nginx-app-1
          image: datacenter:v0.0.1
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 80
---

apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: nginx-app-2
spec:
  replicas: 1
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: &quot;true&quot;
      labels:
        app: nginx-app
        version: v2
    spec:
      containers:
        - name: nginx-app-2
          image: datacenter:v0.0.2
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 80
</code></pre>
<ul>
<li>å»ºç«‹service</li>
</ul>
<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: nginx-svc
  labels:
    svcname: nginx-svc
spec:
  ports:
  - port: 8088
    protocol: TCP
    targetPort: 80
  selector:
    app: nginx-app
</code></pre>
<ul>
<li>å»ºç«‹gateway</li>
</ul>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: nginx-gateway
spec:
  selector:
    istio: ingressgateway # use Istio default gateway implementation
  servers:
  - port:
      number: 80
      name: nginx-http
      protocol: HTTP
    hosts:
    - istio-zcbb.com
</code></pre>
<ul>
<li>å»ºç«‹VirtualService</li>
</ul>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: nginx-vs
spec:
  hosts:
  - istio-zcbb.com
  gateways:
  - nginx-gateway
  http:
  - match:
    - uri:
        prefix: /
    route:
    - destination:
        host: nginx-svc
        subset: v1
      weight: 70
    - destination:
        host: nginx-svc
        subset: v2
      weight: 30
</code></pre>
<ul>
<li>å»ºç«‹DestinationRule</li>
</ul>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: nginx-app
spec:
  host: nginx-svc
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
</code></pre>
<pre><code class="language-shell">Istio Virtual Serviceï¼Œç”¨äºæ§åˆ¶å½“å‰deploymentå’Œé‡‘ä¸é›€deploymentæµé‡åˆ†é…çš„æƒé‡
Istio Destination Ruleï¼ŒåŒ…å«å½“å‰deploymentå’Œé‡‘ä¸é›€deploymentçš„å­é›†ï¼ˆsubsetï¼‰
Istio Gatewayï¼ˆå¯é€‰ï¼‰ï¼Œå¦‚æœæœåŠ¡éœ€è¦ä»å®¹å™¨é›†ç¾¤å¤–è¢«è®¿é—®åˆ™éœ€è¦æ­å»ºgateway
</code></pre>
<p>è‡³æ­¤æœ€ç®€å•çš„é‡‘ä¸é›€å‘å¸ƒå®Œæˆï¼ŒåæœŸå¯ä»¥å®šåˆ¶å„ç§ç°åº¦ç­–ç•¥</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[K8s- è“ç»¿å‘å¸ƒ]]></title>
        <id>https://xxliud.github.io/post/k8s-blue-green/</id>
        <link href="https://xxliud.github.io/post/k8s-blue-green/">
        </link>
        <updated>2020-06-23T16:05:29.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li>å®ç°åŸç†ï¼Œå¤špodï¼Œåˆ‡æ¢service versonæŒ‡å‘</li>
<li>å¯åŠ¨ä¸¤ä¸ªç‰ˆæœ¬çš„deployment</li>
</ul>
<pre><code class="language-yaml">--- service æŒ‡å‘v1
apiVersion: v1
kind: Service
metadata:
  name: demo
  namespace: default
  labels:
    app: demo
spec:
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: demo
    version: v1
--- depliyment v1
apiVersion: apps/v1
kind: Deployment
metadata:
  name: demo1-deployment
  namespace: default
  labels:
    app: demo
    version: v1
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo
      version: v1
  template:
    metadata:
      labels:
        app: demo
        version: v1
    spec:
      containers:
      - name: demo1
        image: database:v0.01
        ports:
          - name: http
            containerPort: 80
            protocol: TCP

--- depliyment v2
apiVersion: apps/v1
kind: Deployment
metadata:
  name: demo2-deployment
  namespace: default
  labels:
    app: demo
    version: v2
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo
      version: v2
  template:
    metadata:
      labels:
        app: demo
        version: v2
    spec:
      containers:
      - name: demo2
        image: database:v0.02
        ports:
          - name: http
            containerPort: 80
            protocol: TCP
</code></pre>
<ul>
<li>åˆ‡æ¢å…¥å£æµé‡ä»v1 åˆ° v2</li>
</ul>
<pre><code class="language-shell">kubectl patch service demo -p '{&quot;spec&quot;:{&quot;selector&quot;:{&quot;version&quot;:&quot;v2&quot;}}}'
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[K8s - å®‰è£…ELK]]></title>
        <id>https://xxliud.github.io/post/k8s-elk/</id>
        <link href="https://xxliud.github.io/post/k8s-elk/">
        </link>
        <updated>2020-06-23T15:25:28.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li>åˆ›å»ºnamespace elk</li>
</ul>
<pre><code class="language-shell">kubectl create namespace elk
</code></pre>
<ul>
<li>åˆ›å»ºelasticsearch deployment service</li>
</ul>
<pre><code class="language-yaml">--- # elasticsearch deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: elasticsearch
  namespace: elk
  labels:
    app: elasticsearch
spec:
  replicas: 1
  selector:
    matchLabels:
      app: elasticsearch
  template:
    metadata:
      labels:
        app: elasticsearch
    spec:
        hostname: elasticsearch
        containers:
         - image: elasticsearch:6.8.4
           imagePullPolicy: IfNotPresent
           name: elasticsearch
           ports:
             - name: es-port
               containerPort: 9200
             - name: es-tran-port
               containerPort: 9300

--- # elasticsearch service
apiVersion: v1
kind: Service
metadata:
  name: elasticsearch
  namespace: elk
  labels:
    name: elasticsearch
spec:
  type: NodePort
  ports:
  - port: 9200
    targetPort: 9200
    protocol: TCP
    nodePort: 30011
  selector:
    app: elasticsearch
</code></pre>
<ul>
<li>åˆ›å»ºlogstash deployment service, é…ç½®æ–‡ä»¶å‚è€ƒä¹‹å‰æ–‡ç« </li>
</ul>
<pre><code class="language-yaml">--- # logstash deploy
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-logstash
  namespace: elk
  labels:
    app: my-logstash
spec:
  replicas: 1
  selector:
    matchLabels:
      app: my-logstash
  template:
    metadata:
      labels:
        app: my-logstash
    spec:
      containers:
        - name: my-logstash
          image: logstash:6.8.4
          imagePullPolicy: IfNotPresent
          ports:
          - containerPort: 5044
          volumeMounts:
          - name: log-config
            mountPath: /usr/share/pipeline
      volumes:
       - name: log-config
         hostPath:
          path: /Users/xingxu/elk/logstash/pipeline

--- # logstash service
apiVersion: v1
kind: Service
metadata:
  name: my-logstash
  namespace: elk
  labels:
    name: my-logstash
spec:
  type: NodePort
  ports:
  - port: 5044
    targetPort: 5044
    protocol: TCP
    nodePort: 30012
  selector:
    app: my-logstash
</code></pre>
<ul>
<li>åˆ›å»ºkibana deployment service</li>
</ul>
<pre><code class="language-yaml">--- # kibana deploy
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-kibana
  namespace: elk
  labels:
    app: my-kibana
spec:
  replicas: 1
  selector:
    matchLabels:
      app: my-kibana
  template:
    metadata:
      labels:
        app: my-kibana
    spec:
      containers:
        - name: my-kibana
          image: kibana:6.8.4
          imagePullPolicy: IfNotPresent
          ports:
          - containerPort: 5601

--- # kibana service
apiVersion: v1
kind: Service
metadata:
  name: my-kibana
  namespace: elk
  labels:
    name: my-kibana
spec:
  type: NodePort
  ports:
  - port: 5601
    targetPort: 5601
    protocol: TCP
    nodePort: 30010
  selector:
    app: my-kibana
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[K8s - zk&kafkaå®‰è£…]]></title>
        <id>https://xxliud.github.io/post/k8s-zk-kafka/</id>
        <link href="https://xxliud.github.io/post/k8s-zk-kafka/">
        </link>
        <updated>2020-06-23T14:56:48.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li>åˆ›å»ºzookerper deployment service</li>
</ul>
<pre><code class="language-yaml">--- # zk deploy
kind: Deployment
apiVersion: apps/v1
metadata:
  name: my-zk
  namespace: base
  labels:
    app: my-zk
spec:
  replicas: 1
  selector:
    matchLabels:
      app: my-zk
  template:
    metadata:
      labels:
        app: my-zk
    spec:
      hostname: my-zk
      dnsPolicy: ClusterFirst
      containers:
      - name: my-zk
        image: zookeeper
        imagePullPolicy: IfNotPresent
        volumeMounts:
        ports:
        - containerPort: 2181
        - containerPort: 2888
        - containerPort: 3888

### zk service
---
apiVersion: v1
kind: Service
metadata:
  name: my-zk
  namespace: base
  labels:
    name: my-zk
spec:
  type: NodePort
  ports:
  - port:
    port: 2181
    targetPort: 2181
    protocol: TCP
        nodePort: 30001
  selector:
    app: my-zk
</code></pre>
<ul>
<li>åˆ›å»ºkafka deployment service</li>
</ul>
<pre><code class="language-yaml">--- # kafka deploy
kind: Deployment
apiVersion: apps/v1
metadata:
  name: my-kafka
  namespace: base
  labels:
    app: my-kafka
spec:
  replicas: 1
  selector:
    matchLabels:
      app: my-kafka
  template:
    metadata:
      labels:
        app: my-kafka
    spec:
      hostname: my-kafka
      dnsPolicy: ClusterFirst
      containers:
      - name: my-kafka
        image: wurstmeister/kafka
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 9092
        env:
        - name: KAFKA_ZOOKEEPER_CONNECT
          value: 'my-zk.base:2181'
        - name: KAFKA_ADVERTISED_HOST_NAME
          value: 'ClusterIP'
        - name: KAFKA_ADVERTISED_PORT
          value: 'NodePort'

--- # kafka service
apiVersion: v1
kind: Service
metadata:
  name: my-kafka
  namespace: base
  labels:
    name: my-kafka
spec:
  type: NodePort
  ports:
  - port: 9092
    targetPort: 9092
    protocol: TCP
    nodePort: 30002
  selector:
    app: my-kafka
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[K8s - Mongoå®‰è£…ç¯‡]]></title>
        <id>https://xxliud.github.io/post/k8s-mongo/</id>
        <link href="https://xxliud.github.io/post/k8s-mongo/">
        </link>
        <updated>2020-06-23T14:38:49.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li>åˆ›å»ºnamespace</li>
</ul>
<pre><code class="language-shell">kubectl create namespace base
</code></pre>
<ul>
<li>åˆ›å»ºdeployment service</li>
</ul>
<pre><code class="language-yaml">--- # mongo deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-mongo
  namespace: base
  labels:
    app: my-mongo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: my-mongo
  template:
    metadata:
      labels:
        app: my-mongo
    spec:
      containers:
      - name: my-mongo
        image: mongo
        ports:
        - containerPort: 27017

---  # mongo service
apiVersion: v1
kind: Service
metadata:
  name: my-mongo
  namespace: base
  labels:
    name: my-mongo
spec:
  type: NodePort
  ports:
  - port: 27017
    targetPort: 27017
    protocol: TCP
    nodePort: 30000
  selector:
    app: my-mongo
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[K8s - å­¦ä¹ èµ„æ–™æ±‡æ€»]]></title>
        <id>https://xxliud.github.io/post/k8s/</id>
        <link href="https://xxliud.github.io/post/k8s/">
        </link>
        <updated>2020-06-23T12:52:02.000Z</updated>
        <content type="html"><![CDATA[<p>[ * ] <a href="https://xxliud.github.io/post/minikube-install" title="minikube-install">Mac Install Minikube</a><br>
[ * ] <a href="https://xxliud.github.io/post/k8s-mongo" title="k8s-mongo">K8s Install Mongo</a><br>
[ * ] <a href="https://xxliud.github.io/post/k8s-zk-kafka" title="k8s-zk-kafka">K8s Install Zookerper Kafka</a><br>
[ * ] <a href="https://xxliud.github.io/post/k8s-elk" title="k8s-elk">K8s Install ELK</a><br>
[ * ] <a href="https://xxliud.github.io/post/k8s-istio" title="k8s-istio">Install Istio</a><br>
[ * ] <a href="https://xxliud.github.io/post/k8s-blue-green" title="k8s-blue-green">K8s Bule Green Release</a><br>
[ * ] <a href="https://xxliud.github.io/post/k8s-gray" title="k8s-gary">K8s Gray Release</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[K8s - Minikubeå®‰è£…ç¯‡]]></title>
        <id>https://xxliud.github.io/post/minikube-install/</id>
        <link href="https://xxliud.github.io/post/minikube-install/">
        </link>
        <updated>2020-06-23T12:52:02.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯k8s">ä»€ä¹ˆæ˜¯k8s</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥å°†é¡¹ç›®åˆ¶ä½œæˆdockeré•œåƒï¼Œç„¶ååˆ©ç”¨dockerå»éƒ¨ç½²æˆ‘ä»¬çš„é¡¹ç›®ï¼Œè¿™æ ·å¯ä»¥è§£å†³å¾ˆå¤šæœåŠ¡å™¨ç¯å¢ƒæ‰€å¸¦æ¥çš„é—®é¢˜ï¼›<br>
ä½†æ˜¯å®¹å™¨å¤šäº†ï¼Œå®¹å™¨ä¸å®¹å™¨ä¹‹é—´å°±éœ€è¦è®¿é—®ï¼Œä¹‹é—´å°±éœ€è¦ç½‘ç»œé…ç½®ç­‰ç­‰ï¼Œä»è€Œå°±æœ‰äº†docker-composeï¼›<br>
ä½†æ˜¯å½“æˆ‘ä»¬çš„æœåŠ¡è¿›è¡Œå‡çº§ï¼Œæˆ–è€…æœåŠ¡éœ€è¦è¿›è¡Œè°ƒåº¦ï¼Œæ‰©å®¹ç­‰ç­‰ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ªå¤§ç®¡å®¶æ¥ç®¡æ‰€æœ‰çš„ä¸œè¥¿ï¼›<br>
è¿™ä¸ªå¤§ç®¡å®¶å°±æ˜¯ - Kubernetes</p>
<h2 id="macå®‰è£…kuberneteså•èŠ‚ç‚¹minikube">macå®‰è£…kuberneteså•èŠ‚ç‚¹minikube</h2>
<ul>
<li>å®‰è£…kubectl æ ¸å¿ƒæ“ä½œç®¡ç†å‘½ä»¤</li>
</ul>
<pre><code class="language-shell">brew install kubernetes-cli
</code></pre>
<ul>
<li>å®‰è£…minikube</li>
</ul>
<pre><code class="language-shell">brew cask install minikube
</code></pre>
<ul>
<li>å¯åŠ¨minikube</li>
</ul>
<pre><code class="language-shell">minikube start -p dockeré•œåƒä»“åº“
Starting local Kubernetes v1.10.0 cluster...
Starting VM...
Getting VM IP address...
Moving files into cluster...
Setting up certs...
Connecting to cluster...
Setting up kubeconfig...
Starting cluster components...
Kubectl is now configured to use the cluster.
Loading cached images from config file.
</code></pre>
<ul>
<li>æŸ¥çœ‹kubernetesçš„dashboard</li>
</ul>
<pre><code class="language-shell">minikube dashboard
</code></pre>
<p>è‡³æ­¤minikubeæ­å»ºå®Œæˆ</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æˆ‘ä»¬ä¸ELKçš„è·ç¦»]]></title>
        <id>https://xxliud.github.io/post/docker-elk/</id>
        <link href="https://xxliud.github.io/post/docker-elk/">
        </link>
        <updated>2020-06-23T12:24:26.000Z</updated>
        <content type="html"><![CDATA[<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2>
<p>å¯¹ELKçš„äº†è§£ä¸€ç›´éƒ½åœç•™åœ¨é«˜å¤§ä¸Šçš„æ„Ÿè§‰ï¼Œå…¬å¸æœ‰ä¸“é—¨çš„éƒ¨åˆ†æï¼Œä¹Ÿæ›¾ç»åœ¨19å¹´1æœˆä»½çš„æ—¶å€™ï¼Œåˆ©ç”¨è¿‡å¹´é—²æš‡æ—¶é—´å°è¯•æ­å»ºï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œå›æƒ³å‘ç°å¦‚æœå½“æ—¶ä¸æ˜¯èµ°æ·å¾„ç›´æ¥æ‹‰å–elkçš„ç»„åˆé•œåƒåŒ…ï¼Œå¯èƒ½æ—©å°±æˆåŠŸäº†ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰æ·å¾„...</p>
<h2 id="æ­å»ºè¿‡ç¨‹">æ­å»ºè¿‡ç¨‹</h2>
<p><img src="https://xxliud.github.io/post-images/1592915083405.jpg" alt="" loading="lazy"><br>
ELKæ˜¯Elasticsearchã€Logstashã€Kibanaä¸‰å¤§å¼€æºæ¡†æ¶é¦–å­—æ¯å¤§å†™ç®€ç§°ã€‚å¸‚é¢ä¸Šä¹Ÿè¢«æˆä¸ºElastic Stackã€‚å…¶ä¸­Elasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneã€åˆ†å¸ƒå¼ã€é€šè¿‡Restfulæ–¹å¼è¿›è¡Œäº¤äº’çš„è¿‘å®æ—¶æœç´¢å¹³å°æ¡†æ¶ã€‚åƒç±»ä¼¼ç™¾åº¦ã€è°·æ­Œè¿™ç§å¤§æ•°æ®å…¨æ–‡æœç´¢å¼•æ“çš„åœºæ™¯éƒ½å¯ä»¥ä½¿ç”¨Elasticsearchä½œä¸ºåº•å±‚æ”¯æŒæ¡†æ¶ï¼Œå¯è§Elasticsearchæä¾›çš„æœç´¢èƒ½åŠ›ç¡®å®å¼ºå¤§,å¸‚é¢ä¸Šå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ç®€ç§°Elasticsearchä¸ºesã€‚Logstashæ˜¯ELKçš„ä¸­å¤®æ•°æ®æµå¼•æ“ï¼Œç”¨äºä»ä¸åŒç›®æ ‡ï¼ˆæ–‡ä»¶/æ•°æ®å­˜å‚¨/MQï¼‰æ”¶é›†çš„ä¸åŒæ ¼å¼æ•°æ®ï¼Œç»è¿‡è¿‡æ»¤åæ”¯æŒè¾“å‡ºåˆ°ä¸åŒç›®çš„åœ°ï¼ˆæ–‡ä»¶/MQ/redis/elasticsearch/kafkaç­‰ï¼‰ã€‚Kibanaå¯ä»¥å°†elasticsearchçš„æ•°æ®é€šè¿‡å‹å¥½çš„é¡µé¢å±•ç¤ºå‡ºæ¥ï¼Œæä¾›å®æ—¶åˆ†æçš„åŠŸèƒ½ã€‚</p>
<p>ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹dockerä¸‹å¦‚ä½•æ­å»ºelkå¹³å°</p>
<p>æˆ‘ä»¬çš„æ¶æ„å›¾ï¼š<br>
<img src="https://xxliud.github.io/post-images/1592915101615.png" alt="" loading="lazy"></p>
<p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨dockerè¿›è¡Œæ­å»º</p>
<ul>
<li>åˆ›å»ºç½‘ç»œ</li>
</ul>
<pre><code class="language-shell">docker network create somenetwork
</code></pre>
<ul>
<li>æ‹‰å–éœ€è¦çš„é•œåƒ</li>
</ul>
<pre><code class="language-shell">docker pull zookeeper:latest   # zk
docker pull wurstmeister/kafka:latest  # kafka
docker pull elasticsearch:6.8.4  # es
docker pull logstash:6.8.4  # logstash
docker pull kibana:6.8.4   #kibana
</code></pre>
<ul>
<li>åˆ›å»ºzk + kafka</li>
</ul>
<pre><code class="language-shell"># zookeeper
docker run -d --name zookeeper \
--publish 2181:2181  zookeeper:latest

# kafka
docker run -d --name kafka --publish 9092:9092 \
--link zookeeper \
--env KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181 \
--env KAFKA_ADVERTISED_HOST_NAME=kafkaæ‰€åœ¨å®¿ä¸»æœºçš„IP \
--env KAFKA_ADVERTISED_PORT=9092 \
--net somenetwork
wurstmeister/kafka:latest


# æµ‹è¯•
docker exec -it kafka /bin/bash
# è¿›å…¥binç›®å½•
cd /opt/kafka_2.25-2.3.0/bin/
# åˆ›å»ºtopic
./kafka-topics.sh --create --zookeeper zookeeper:2181 --replication-factor 1 --partitions 1 --topic elk-kafka-test 
# è¿è¡Œç”Ÿäº§è€…å¹¶æŒ‡å®štopic
./kafka-console-producer.sh --broker-list 127.0.0.1:9092 --topic elk-kafka-test 
# æ–°å¼€çª—å£è¿è¡Œæ¶ˆè´¹è€…ï¼ŒæŒ‡å®šåŒæ ·çš„topicï¼Œ æ³¨æ„æ›¿æ¢kafkaIp
./kafka-console-consumer.sh --bootstrap-server kafkaIp:9092 --topic elk-kafka-test --from-beginning
</code></pre>
<ul>
<li>Elasticsearch å®‰è£…</li>
</ul>
<pre><code class="language-shell">docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:6.8.4
</code></pre>
<p>éªŒè¯ curl http://localhost:9200<br>
<img src="https://xxliud.github.io/post-images/1592915628111.jpg" alt="" loading="lazy"></p>
<ul>
<li>Kibana å®‰è£…</li>
</ul>
<pre><code class="language-shell">docker run -d --name kibana --net somenetwork -p 5601:5601 kibana:6.8.4
</code></pre>
<p>éªŒè¯ æµè§ˆå™¨è®¿é—® http://localhost:5601<br>
<img src="https://xxliud.github.io/post-images/1592915675748.jpg" alt="" loading="lazy"></p>
<ul>
<li>Logstash å®‰è£…<br>
vim vim logstash.conf/logstash.conf</li>
</ul>
<pre><code class="language-shell">input {
   kafka {
     bootstrap_servers =&gt; [&quot;kafka:9092&quot;]
     auto_offset_reset =&gt; &quot;latest&quot;
     consumer_threads =&gt; 5
     decorate_events =&gt; true
     group_id =&gt; &quot;elk&quot;
     topics =&gt; [&quot;elk_kafka_test&quot;]
     type =&gt; &quot;bhy&quot;
     codec =&gt; json {
             charset =&gt; &quot;UTF-8&quot;
     }
   }
}

output {
   stdout {}
   elasticsearch {
     hosts =&gt; [&quot;elasticsearch:9200&quot;]
     index =&gt; &quot;test-elk-%{+YYYY.MM.dd}&quot;
   }
}
</code></pre>
<pre><code class="language-shell">docker run -it -d -p 5044:5044 --name logstash \
--net somenetwork --link kafka --link elasticsearch \
-v c:/usr/share/pipeline logstash:6.8.4
</code></pre>
<ul>
<li>FileBeat é…ç½®ç›‘å¬<br>
ç¼–è¾‘filebeat.yml</li>
</ul>
<pre><code class="language-shell">filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /data/log/*.log
  fields:
    docType: sys-log

output.kafka:
  hosts: [&quot;kafkaIp:9092&quot;]
  topic: &quot;elk_kafka_test&quot;
</code></pre>
<p>å¯åŠ¨filebeat</p>
<pre><code class="language-shell">./filebeat -c filebeat.yml -e
</code></pre>
<p>åœ¨/data/log/ç›®å½•ä¸‹å˜æ›´æ—¥å¿—æ–‡ä»¶ï¼Œfilebeatç›‘å¬åˆ°å˜åŒ–ï¼Œå°†æ—¥å¿—åœ¨kafkaä¸­ç”Ÿäº§å¾…logstashè¿›è¡Œæ¶ˆè´¹ï¼Œåœ¨logstashå®¹å™¨å†…å¯ä»¥çœ‹åˆ°æ—¥å¿—è½¬æ¢æˆjsonæ ¼å¼çš„æ•°æ®å­˜å‚¨åˆ°logstashé‡Œ<br>
<img src="https://xxliud.github.io/post-images/1592915981638.jpg" alt="" loading="lazy"><br>
åœ¨kibanaä¸­æŸ¥çœ‹<br>
<img src="https://xxliud.github.io/post-images/1592915998023.jpg" alt="" loading="lazy"><br>
è‡³æ­¤ELKæ­å»ºå®Œæˆ</p>
]]></content>
    </entry>
</feed>